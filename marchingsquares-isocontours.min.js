/*
 @license GNU Affero General Public License.
 Copyright (c) 2015, 2015 Ronny Lorenz <ronny@tbi.univie.ac.at>
 v. 1.2.2
 https://github.com/RaumZeit/MarchingSquares.js
*/
(function(a,t){"function"===typeof define&&define.amd?define([],function(){return{isoContours:t()}}):"object"===typeof module&&module.exports?module.exports={isoContours:t()}:a.MarchingSquaresJS={isoContours:t(),isoBands:a.MarchingSquaresJS?a.MarchingSquaresJS.isoBands:null}})(this,function(){function a(a,b,u){return(a-b)/(u-b)}function t(a){0!==a.cval&&15!==a.cval&&5!==a.cval&&10!==a.cval&&(a.cval=15)}function A(a,b){if("top"===b)return[a.top,1];if("bottom"===b)return[a.bottom,0];if("right"===b)return[1,
a.right];if("left"===b)return[0,a.left]}function C(a){var b=[],u=0;a.cells.forEach(function(q,r){q.forEach(function(p,n){if("undefined"!==typeof p&&5!==p.cval&&10!==p.cval&&0!==p.cval&&15!==p.cval){a:{var c=a.cells;var l=c.length,d=[],f=[0,-1,0,-1,1,0,0,-1,0,0,0,0,1,1,0,0],g=[0,0,-1,0,0,0,-1,0,1,1,0,1,0,0,-1,0],q="none left bottom left right none bottom left top top none top right right bottom none".split(" "),h=c[r][n],e=h.cval;var k="none bottom right right top none top top left bottom none right left bottom left none".split(" ")[e];
var m=A(h,k);d.push([n+m[0],r+m[1]]);k=q[e];m=A(h,k);d.push([n+m[0],r+m[1]]);t(h);var v=n+f[e],z=r+g[e];m=f[e];for(var y=g[e];0<=v&&0<=z&&z<l&&(v!=n||z!=r);){h=c[z][v];if("undefined"===typeof h)break;e=h.cval;if(0===e||15===e){c=d;break a}if(5===e||10===e)if(5===e)if(h.flipped)if(1===m){k="top";var w=0;var x=1}else k="bottom",w=0,x=-1;else-1===y?(k="left",w=-1):(k="right",w=1),x=0;else 10===e&&(h.flipped?(-1===y?(k="right",w=1):(k="left",w=-1),x=0):-1===m?(k="top",w=0,x=1):(k="bottom",w=0,x=-1));
else k=q[e],w=f[e],x=g[e];m=A(h,k);d.push([v+m[0],z+m[1]]);t(h);v+=w;z+=x;m=w;y=x}c=d}b[u++]=c}})});return b}var B={successCallback:null,verbose:!1},y={};return function(q,b,u){u=u?u:{};for(var v=Object.keys(B),r=0;r<v.length;r++){var p=v[r],n=u[p];n="undefined"!==typeof n&&null!==n?n:B[p];y[p]=n}y.verbose&&console.log("MarchingSquaresJS-isoContours: computing isocontour for "+b);u=q.length-1;v=q[0].length-1;r={rows:u,cols:v,cells:[]};for(p=0;p<u;++p)for(r.cells[p]=[],n=0;n<v;++n){var c=0,l=q[p+1][n],
d=q[p+1][n+1],f=q[p][n+1],g=q[p][n];if(!(isNaN(l)||isNaN(d)||isNaN(f)||isNaN(g))){c|=l>=b?8:0;c|=d>=b?4:0;c|=f>=b?2:0;c|=g>=b?1:0;var t=!1;if(5===c||10===c){var h=(l+d+f+g)/4;5===c&&h<b?(c=10,t=!0):10===c&&h<b&&(c=5,t=!0)}if(0!=c&&15!=c){var e,k,m;h=e=k=m=.5;1===c?(k=1-a(b,l,g),e=1-a(b,f,g)):2===c?(e=a(b,g,f),m=1-a(b,d,f)):3===c?(k=1-a(b,l,g),m=1-a(b,d,f)):4===c?(h=a(b,l,d),m=a(b,f,d)):5===c?t?(h=1-a(b,l,d),m=1-a(b,d,f),e=a(b,g,f),k=a(b,g,l)):(h=a(b,l,d),m=a(b,f,d),e=1-a(b,f,g),k=1-a(b,l,g)):6===
c?(e=a(b,g,f),h=a(b,l,d)):7===c?(k=1-a(b,l,g),h=a(b,l,d)):8===c?(k=a(b,g,l),h=1-a(b,d,l)):9===c?(e=1-a(b,f,g),h=1-a(b,d,l)):10===c?t?(h=a(b,l,d),m=a(b,f,d),e=1-a(b,f,g),k=1-a(b,l,g)):(h=1-a(b,d,l),m=1-a(b,d,f),e=a(b,g,f),k=a(b,g,l)):11===c?(h=1-a(b,d,l),m=1-a(b,d,f)):12===c?(k=a(b,g,l),m=a(b,f,d)):13===c?(e=1-a(b,f,g),m=a(b,f,d)):14===c?(k=a(b,g,l),e=a(b,g,f)):console.log("MarchingSquaresJS-isoContours: Illegal cval detected: "+c);r.cells[p][n]={cval:c,flipped:t,top:h,right:m,bottom:e,left:k}}}}q=
C(r);"function"===typeof y.successCallback&&y.successCallback(q);return q}});
